---
title: 腾讯云三面
date: 2019-03-27 22:55:51
tags:
---

CSIG腾讯云三面情况

在一段时间没有音讯之后，等来的腾讯云面试官的电话，面试又是一个小时。
非常感动，面试官真的非常好，给我讲了好多课 :)

在这次面试之前，还有一个视频面试，视频面试答得一般，最后程序写的有些慢了，面试官催了几次，好在没有变灰。
程序要求是用js写个函数，输出字符串出现次数最多的字符和相应的次数。
<!-- more -->

### 介绍一下项目
说了微信小程序控制智能家居 和 考试报名查分系统
#### 硬件控制项目后端的api鉴权是怎么做的
讲了一下微信本身的鉴权，以及jwt的鉴权
#### 如何绑定小程序用户和设备
讨论了比较长时间，关于设备的唯一标识码


### 浏览器的事件模型，事件代理，事件委托
讲了事件冒泡，表单内部组件不用每个都加上事件
#### 具体怎么做
讲了事件冒泡后e.preventDefault()

### 为什么会产生跨域问题
[浏览器的同源策略](https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy)
原因是为了防止一些安全问题，如果没有同源策略，假如用户登录了网站A，打开了恶意网站B，恶意网站中的脚本可能会将A网站的数据上传到自己的服务器中，禁止跨域以后可以解决这种问题
即使有了同源策略以后，依然可能会有CSRF攻击的相关情况，如何防范CSRF，如何处理跨域
#### CORS的相应情况，服务端返回的响应头请求
答得一知半解，面试官告诉我浏览器生成Origin头，服务端判断Origin是否在白名单中，在则添加运行跨域的头


### WebSocket内部原理
我说了基于http请求，面试官问如何告诉对方想要建立连接，最后面试官告诉我是特殊请求头，建议我多补充http的相关知识
在请求头中标识相关信息，提示对协议进行升级
Upgrade: websocket
Connection: Upgrade
[nodejs深入学网络](https://www.jianshu.com/p/0c77d59ec2d0) 自行定位到‘构建websocket服务’


### DNS查询的过程
讲了DNS缓存，迭代查询，递归查询

### CDN的架构，如何做到选择近处的CDN节点的
[内容分发网络](https://baike.baidu.com/item/%E5%86%85%E5%AE%B9%E5%88%86%E5%8F%91%E7%BD%91%E7%BB%9C/4034265)
首先在访问DNS服务器的过程后，DNS系统会将最终域名的解析权交给CNAME指向的CDN专用DNS服务器，
CDN的DNS服务器将DNS全局负载均衡设备IP返回给用户，用户继续向CDN全局负载均衡设备发起访问，
负载均衡设备会根据设备的IP地址，请求的URL，选择一台用户所属区域的负载均衡设备，
区域负载均衡将会根据用户的IP与请求内容选择合适的缓存服务器，将缓存服务器地址返回给用户，
用户向缓存服务器进行请求，缓存服务器在本地缓存中查找内容，查找到则返回，如果没有找到则内部路由到其他缓存服务器获取，或追溯到网站的源服务器拉取内容到本地，最终返回。
![DNS过程图例](https://github.com/MeetzhDing/Meetzhding.github.io/blob/Blog/picture/DNS%E8%BF%87%E7%A8%8B.png?raw=true)

#### CDN节点上如果没有某个文件，会怎么样
CDN的回源，有人访问，本地无文件，会主动去源站或其他缓存服务器获取
#### CDN的缓存策略是什么样的
各个CDN节点的缓存策略因服务商不同而不同，一般会遵循http标准协议，更具Cache-control，max-age字段来设置CDN边缘节点的缓存时间
[CDN回源原理与常见多级缓存策略](https://www.jianshu.com/p/e7751ecb6f21)


### Node怎么做到进程管理（例如利用多核性能）
#### 使用Cluster如何监听同一个端口
cluster的实现本身，将会产生一个Master进程和多个Worker子进程，有点类似于单生产者多消费者问题
[源码解析Node中的cluster实现](https://cnodejs.org/topic/56e84480833b7c8a0492e20c)
#### 两个进程是怎么样通信的
进程间通信使用了child_process模块，内部实现由libuv提供，根据平台不同而有所不同
[nodejs深入学进程](https://www.jianshu.com/p/335a9e101c3f)


### Node里面的流有哪些
可写流：http请求，fs写入流，zlib流，crypto流，tcp socket，子进程stdin，标准输出流，标准错误流
可读流：除以上流类以外，还包括标准输入流process.stdin
除此以外还有双工流，转换流
[nodejs文档stream](http://nodejs.cn/api/stream.html)
[nodejs深入学理解Buffer](https://www.jianshu.com/p/e3f14cdf78f1)

#### Node里面如何建立tcp服务器
net模块，createServer函数


### 服务器日志怎么处理的
文件追加，文件名根据时间确定，不用的日志进行打包


### 服务端干了什么，数据库怎么操作的
CRUD 服务端主要是业务，进行增删查改
数据库使用了knex，维护了一个连接池，进行辅助sql操作


### 性能优化做了哪些方面的努力
说了返回内容压缩中间件，面试官告诉我存的时候就该压缩。
对大量独立数据库查询进行了同时查询，当所有查询都完成后一并进行回调
还可以做哪些性能优化操作？（待整理）


### XSS漏洞原理，如何防范（死亡问题）
我回答了表单输入的，存储型XSS，面试官问就这种存储型攻击怎么解决的
在什么地方去拦截？我回答js中做处理
面试官提醒恶意用户可能直接发包，不经过标准的js，怎么办
我回答服务端进行操作，转义。面试官说这样做还有问题（内心即将崩溃）
面试官问XSS漏洞到底是哪里的漏洞？答不上来
面试官引导问Vue这些框架是怎么处理XSS攻击的？答不出来
面试官告诉我是在展示之前，做好处理，再将内容渲染到浏览器上

Vue文档中有关模板语法的小节，有这样一句话：请只对可信内容使用 HTML 插值，绝不要对用户提供的内容使用插值。
除了存储型，还有一大类是反射性，通过隐藏内容在连接中，用户点击后触发。
[反射型XSS](https://blog.csdn.net/huli870715/article/details/8615473)
[反射型XSS漏洞的条件+类型+危害+解决](https://blog.csdn.net/wuhuagu_wuhuaguo/article/details/79774187)
